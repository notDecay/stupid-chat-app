import{g as O,a as n,A as T,i as o,H as Z,t as i,m as M,I as R,T as H,B as m,D as S,C as $,F as A,h as C,e as l,j as I,o as D,f as B,u as k,l as E,_ as F,k as W,n as Q,d as z,G as j}from"./index-58aeaa16.js";import{F as U,S as P,a as b,P as V,l as G,b as N}from"./index-74d9a961.js";const y="data:image/png;base64,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",L=i("<div><div>"),q=e=>n(U,{centerOn:"y",gap:15,lineHeight:"normal",class:"conversation",get children(){return[n(T,{name:"Duck",get src(){return e.avatarUrl},boxSize:42}),(()=>{const t=L(),s=t.firstChild;return o(t,n(Z,{get children(){return e.name}}),s),o(s,()=>e.description),t})()]}}),J=O();async function ee(){return[{name:"Test",description:"test",avatarUrl:y,route:"/test"},{name:"something",description:"test",avatarUrl:y,route:"/"+J}]}const te=i('<svg><path fill="currentColor" d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z"></svg>',!1,!0),ne=e=>n(R,M({viewBox:"0 0 448 512"},e,{get children(){return te()}})),se=i("<div>"),re=i('<div class="more-options">'),ae=({onSending:e})=>n(m,{class:"message-input",get children(){return[se(),n(U,{centerOn:"y",class:"input-wrapper",gap:20,px:15,py:10,get children(){return[n(ce,{}),n(H,{resize:"none",rows:1,placeholder:"Slap your keyboard to say something",lineHeight:"normal",variant:"unstyled",fontSize:15,onInput:ie,onKeyPress:t=>{if(t.key!=="Enter"||t.key=="Enter"&&t.shiftKey)return;const s=t.currentTarget;t.preventDefault(),_(s),e(s.value.trim()),s.value=""}})]}})]}}),oe=20;function ie(e){const t=e.target;t.scrollHeight>oe*15||(_(t),t.style.height=t.scrollHeight+"px")}function _(e){e.style.height=""}const ce=()=>n(m,{py:"$2",get children(){const e=re();return o(e,n(ne,{boxSize:20})),e}}),le=i('<svg><path fill="currentColor" d="M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"></svg>',!1,!0),ue=e=>n(R,M({viewBox:"0 0 512 512"},e,{get children(){return le()}}));let c=function(e){return e[e.CanReplyMessages=0]="CanReplyMessages",e[e.CanEditYourMessage=1]="CanEditYourMessage",e[e.CanDeleteYourMessage=2]="CanDeleteYourMessage",e}({});const he={[c.CanReplyMessages]:()=>n(pe,{icon:()=>n(ue,{})}),[c.CanDeleteYourMessage]:()=>[],[c.CanEditYourMessage]:()=>[]},ge=[c.CanReplyMessages,c.CanEditYourMessage,c.CanDeleteYourMessage],K=({options:e})=>{(!e||e==="USE_DEFAULT")&&(e=ge);const t={};return n(m,{class:"message-options",flexGrow:1,get children(){return n(A,{class:"wrapper",get children(){return n(C,{each:e,children:s=>`option-${s}`in t?(l.warn("Dupication option found:",c[s]),null):(t[`option-${s}`]=s,n(S,{get component(){return he[s]}}))})}})}})},pe=({icon:e})=>n($,{class:"option-button",flexGrow:1,get children(){return n(S,{component:e})}}),de=i("<div>"),Ae=i("<b>"),fe=i('<span class="time">'),me=i('<div class="message-content"><div>'),Ce=i('<div class="message user"><div>'),we=i('<div class="message user follow-up"><div class="message-content"><div>'),ye=e=>!e.isFollowUp||e.replyTo?n(ve,e):n(Oe,e),ve=({user:e,content:t,date:s,id:r,replyTo:a})=>{const p=new Intl.DateTimeFormat("en").format(s);return(()=>{const h=Ce();return h.firstChild,o(h,n(A,{gap:"var(--gap-between-avatar-and-content)",get children(){return[(()=>{const u=de();return o(u,n(T,{src:"something",class:"user-avatar"})),u})(),(()=>{const u=me(),w=u.firstChild;return o(u,n(A,{class:"username",alignItems:"center",gap:17,get children(){return[(()=>{const g=Ae();return o(g,()=>e.name),g})(),(()=>{const g=fe();return o(g,p),g})()]}}),w),o(w,t),u})(),n(K,{})]}}),null),h})()},Oe=({content:e})=>(()=>{const t=we(),s=t.firstChild,r=s.firstChild;return o(r,e),o(t,n(K,{}),null),t})(),d=new Map;function x(e){if(d.has(e))return l.info(`"${e}" cache store already exist, no need to create a new one`),d.get(e);const t=new Map;return d.set(e,t),l.info(`Cannot find "${e}" cache store
    created new cache store: "${e}"
  `),t}const{CHAT_ROUTE:v}=B.appRoutes;let f=()=>void l.info("nothing here");const Te=()=>{const[e,t]=I([]);function s(r,a){f=()=>a,l.log("route",`sent u into "${r}" route`);const p=Array.from(a).flat().filter(h=>typeof h!="string");t(p)}return D(()=>{if(location.pathname.replace(v,"")!==""){const r=location.pathname.replace(v,"");s(r,x(r))}Y.on("switchingChat",(r,a)=>{s(r,a)})}),n(b,{class:"chat",get children(){return[n(P,{scrollOn:"y",class:"message-wrapper",get children(){return n(C,{get each(){return e()},children:r=>n(ye,r)})}}),n(ae,{onSending:r=>Me(r,[t])})]}})};async function Me(e,[t]){if(e==="")return l.info("empty message sent");const s=await Se(e),r={content:e,date:new Date,id:O(),isFollowUp:Re(f())?.user.id==sessionStorage.getItem("user"),user:{name:"unknown",id:sessionStorage.getItem("user")},renderedMessage:s};t(a=>[...a,{...r,content:s}]),f()?.set(r.id,r)}function Re(e){return Array.from(e?.values()??{}).pop()}async function Se(e){return e}class Ie{#e={};on(t,s){return this.#e[t]=this.#e[t]||[],this.#e[t].push(s),this}once(t,s){this.#e[t]=this.#e[t]||[];const r=()=>{s(),this.off(t,r)};return this.#e[t].push(r),this}off(t,s){let r=this.#e[t];if(!r)return this;for(let a=r.length;a>0;a--)if(r[a]===s){r.splice(a,1);break}return this}emit(t,...s){let r=this.#e[t];return r?(r.forEach(a=>{a(...s)}),!0):!1}getlistenerCount(t){return(this.#e[t]||[]).length}getRawListeners(t){return this.#e[t]}}const{CHAT_ROUTE:X}=B.appRoutes,Y=new Ie,Ke=()=>{const e=k();return D(()=>{N(t=>{e(t)})}),n(V,{sidebar:Ee,main:Te,class:"chat-view"})},De=E(()=>F(()=>import("./ChatSearchBar-4e62e658.js"),["assets/ChatSearchBar-4e62e658.js","assets/index-58aeaa16.js","assets/index-b72cbbac.css"])),Be=E(()=>F(()=>import("./ChatSearchResult-7fc4e69a.js"),["assets/ChatSearchResult-7fc4e69a.js","assets/index-58aeaa16.js","assets/index-b72cbbac.css"])),Ee=()=>{const[e]=W(ee),[t,s]=I(!0);return n(j,{templateRows:"auto 1fr",height:"100%",get children(){return[n(De,{setShowChatConversations:s}),n(P,{scrollOn:"y",class:"chat-conversation-list",get children(){return Q(()=>!!t())()?n(C,{get each(){return e()},children:r=>n(z,{get href(){return`${X}${r.route}`},onClick:()=>Ue(r.route),get children(){return n(q,r)}})}):n(Be,{})}})]}})};function Fe(e){Y.emit("switchingChat",e,x(e))}function Ue(e){const t=location.pathname.replace(X,"")===e;if(G.set(e),t)return l.info("same location");Fe(e)}export{Y as chatEvents,Ke as default,Ue as switchingTheChat};
